---
title: "Drinking Water Access and Gross Domestic Product (GDP) per capita in ASEAN Countries: A Comparative Study"
date: today
author:
  name: "Adnan Wijayarso"
  orcid: 0009-0005-0216-5559
  email: "adnanwijayarso@gmail.com"
abstract:
  (to be summarized)
license: "CC BY"
format: 
  html:
    toc: true
    code-fold: true
execute: 
  warning: false
citation: 
  container-title: My Blog
  url: https://www.example.com
editor: source
---

## Introduction

Clean drinking water is essential for our life, therefore universal access to safe drinking water is a fundamental human right. On September 2000, the United Nations declared the Millenium Development Goals (MDGs) which targeted to halve the proportion of the population without sustainable access to safe drinking water by 2015. The agenda was even made to be more ambitious by the declaration of Sustainable Development Goals (SDGs) in 2016 which targets all countries participating to ensure availability of safely managed drinking water by 2030.

Achieving the goal obviously requires tremendous resources, and Gross Domestic Product (GDP) is the most used tool by governments to measure the economic health of a country. This data analysis project is meant to explore how drinking water access differs across ASEAN countries and how it correlates with Gross Domestic Product (GDP) per capita for each country.

## Methods

### Importing and tidying the data

In this project, we're using two data sets:

1.  The WHO/UNICEF Joint Monitoring Programme for [Water Supply, Sanitation, and Hygiene (JMP) Global Database](https://washdata.org/data/household#!/)

2.  The World Bank and OECD National Accounts data files on [GDP per capita (in current US$) for East Asia & Pacific Region](https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?end=2022&locations=4E&start=1960&view=chart)

```{r}
# Loading the packages
library(tidyverse)
library(readxl)
library(janitor)

# Importing datasets
WLD_data_raw <- read_excel(here::here("data/raw/JMP_2023_WLD_.xlsx"))
GDPpercap_raw <- read_excel(here::here("data/raw/API_NY.GDP.PCAP.CD_DS2_en_excel_v2_6298460_.xlsx"))

# Tidying JMP datasets
WLD_data_noref <- WLD_data_raw[3:5361,] |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = "DRINKING WATER") |>
  relocate(...43, .before = "DRINKING WATER") |> 
  rename(sdg_region = ...43) |> 
  rename(country = `DRINKING WATER`) |> 
  rename(year = Year) |> 
  rename(population_1000 = `Population(thousands)`) |> 
  rename(rural_basic = RURAL...6) |> 
  rename(rural_limited = ...7) |> 
  rename(rural_unimproved = ...8) |> 
  rename(rural_surfacewater = ...9) |> 
  rename(urban_basic = URBAN...11) |> 
  rename(urban_limited = ...12) |> 
  rename(urban_unimproved = ...13) |> 
  rename(urban_surfacewater = ...14) |> 
  rename(national_basic = TOTAL...16) |> 
  rename(national_limited = ...17) |> 
  rename(national_unimproved = ...18) |> 
  rename(national_surfacewater = ...19) |> 
  rename(rural_safelymanaged = RURAL...21) |> 
  relocate(rural_safelymanaged, .before = rural_basic) |> 
  rename(rural_piped = ...26) |> 
  rename(rural_nonpiped = ...27) |> 
  rename(urban_safelymanaged = URBAN...28) |> 
  relocate(urban_safelymanaged, .before = urban_basic) |> 
  rename(urban_piped = ...33) |> 
  rename(urban_nonpiped = ...34) |> 
  rename(national_safelymanaged = TOTAL...35) |> 
  relocate(national_safelymanaged, .before = national_basic) |> 
  rename(national_piped = ...40) |> 
  rename(national_nonpiped = ...41) |> 
  relocate(...10, .after = ...46) |> 
  relocate(...15, .after = ...46) |> 
  relocate(...20, .after = ...46) |> 
  relocate(...22, .after = ...46) |> 
  relocate(...23, .after = ...46) |>
  relocate(...24, .after = ...46) |> 
  relocate(...25, .after = ...46) |> 
  relocate(...29, .after = ...46) |> 
  relocate(...30, .after = ...46) |> 
  relocate(...31, .after = ...46) |> 
  relocate(...32, .after = ...46) |> 
  relocate(...36, .after = ...46) |> 
  relocate(...37, .after = ...46) |> 
  relocate(...38, .after = ...46) |> 
  relocate(...39, .after = ...46)
WLD_data_noref <- WLD_data_noref[,1:28]
WLD_iso3_year <- WLD_data_noref[,1:5] |> 
  unite(iso3_year, ISO3, year, sep = "_") |> 
  relocate(iso3_year, .after = "id")
WLD_iso3_year <- WLD_iso3_year[,1:2]
WLD_data <- WLD_data_noref |> 
  left_join(WLD_iso3_year, by = "id") |> 
  relocate("iso3_year", .after = year)


# Tidying World Bank GDP per capita dataset
GDPpercap_varnames <- c(GDPpercap_raw[3,])
GDPpercap <- GDPpercap_raw[4:269,]
names(GDPpercap) <- GDPpercap_varnames
GDPpercap <- GDPpercap |> 
  rename(country = `Country Name`) |> 
  rename(iso3 = `Country Code`) |> 
  rename(sdg_region = Region) |> 
  rename(levels_income = IncomeGroup) |> 
  relocate(`Indicator Name`, .before = country) |> 
  relocate(`Indicator Code`, .before = country)
GDPpercap_long_noref <- GDPpercap[,3:69] |> 
  pivot_longer(cols = "1960":"2022",
               names_to = "year",
               values_to = "GDPpercap") |> 
  relocate(year, .after = iso3) |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = country)
GDP_iso3_year <- GDPpercap_long_noref[,1:4] |> 
  unite(iso3_year, iso3, year, sep = "_") |> 
  relocate("iso3_year", .after = "id")
GDPpercap_long <- GDPpercap_long_noref |> 
  left_join(GDP_iso3_year, by = "id") |> 
  relocate(sdg_region, .before = "country.x") |> 
  relocate("iso3_year", .after = "year")
GDPpercap_long <- GDPpercap_long[,6:8] |> 
  mutate(id = row_number()) |> 
  relocate("id", .before = "iso3_year")
  

# Merging JMP and GDP dataset into a new WaterService_vs_GDP object
WaterService_vs_GDP_wide <- WLD_data |> 
  left_join(GDPpercap_long, by = "iso3_year") |> 
  relocate(levels_income, .before = "population_1000") |> 
  relocate(GDPpercap, .before = "population_1000") |> 
  relocate("iso3_year", .after = national_nonpiped)
WaterService_vs_GDP_wide <- WaterService_vs_GDP_wide[,1:30] |> 
  rename(id = id.x)

WaterService_vs_GDP_long <- WaterService_vs_GDP_wide |> 
  # Converting the data frame into long-format data
  pivot_longer(cols = rural_safelymanaged:national_nonpiped,
               names_to = "residence_levelservice",
               values_to = "percentage") |> 
  separate_wider_delim(cols = "residence_levelservice",
                       names = c("residence","level_service"),
                       delim = "_") |> 
  # Tidying level of drinking water service
  mutate(method_waterservice = case_when(
    level_service == "piped" ~ "piped",
    level_service == "nonpiped" ~ "non-piped",
    TRUE ~ NA)) |> 
  mutate(levels_service_new = case_when(
    method_waterservice == "piped" ~ "improved",
    method_waterservice == "non-piped" ~ "improved",
    TRUE ~ level_service)) |> 
  mutate(levels_service = case_when(
    levels_service_new == "safelymanaged" ~ "safely managed",
    levels_service_new == "surfacewater" ~ "surface water",
    TRUE ~ levels_service_new)) |> 
  relocate(levels_service, .before = method_waterservice) |> 
  relocate(percentage, .after = method_waterservice) |> 
  relocate(level_service, .after = percentage) |> 
  mutate(id = row_number()) |> 
  rename(country_population_1000 = population_1000) |> 
  # Removing non-number values from GDPpercap and percentage variable 
  mutate(percentage = as.numeric(percentage)) |> 
  # Counting served population_1000 on national, urban, and rural level
    mutate(served_population_1000 = case_when(
    residence == "national" ~ country_population_1000 * (percentage/100),
    residence == "urban" ~ country_population_1000 * (`% urban`/100) * (percentage/100),
    residence == "rural" ~ country_population_1000 * ((100 - `% urban`)/100) * (percentage/100))) |> 
  relocate(served_population_1000, .after = percentage) |> 
  rename(served_percentage = percentage)

WaterService_vs_GDP_long <- WaterService_vs_GDP_long[,1:14]
glimpse(WaterService_vs_GDP_long)

# Establishing the level_income and level_service using factor
factor_income <- c("High income","Upper middle income", "Lower middle income", "Low income")
factor_waterservice <- c("safely managed", "improved", "basic", "limited", "unimproved", "surface water")
WaterService_vs_GDP_long <- WaterService_vs_GDP_long |> 
  mutate(levels_income = factor(levels_income, levels = factor_income)) |> 
  mutate(levels_service = factor(levels_service, levels = factor_waterservice)) |> 
  # Creating new ASEAN region
  mutate(new_region = case_when(
    ISO3 == "VNM" ~ "ASEAN",
    ISO3 == "THA" ~ "ASEAN",
    ISO3 == "SGP" ~ "ASEAN",
    ISO3 == "PHL" ~ "ASEAN",
    ISO3 == "MMR" ~ "ASEAN",
    ISO3 == "MYS" ~ "ASEAN",
    ISO3 == "LAO" ~ "ASEAN",
    ISO3 == "KHM" ~ "ASEAN",
    ISO3 == "BRN" ~ "ASEAN",
    ISO3 == "IDN" ~ "ASEAN",
    TRUE ~ NA)) |> 
  relocate(new_region, .after = sdg_region) |> 
  rename(urban_percentage = `% urban`)
  
# Grouping each region so that we can compare the average of each region to ASEAN countries
WaterService_vs_GDP_refcolumn <- WaterService_vs_GDP_long |> 
  unite(refcolumn, sdg_region, year, residence, levels_service, method_waterservice, sep = "_") |> 
  relocate(refcolumn, .after = "id")
WaterService_vs_GDP_refcolumn <- WaterService_vs_GDP_refcolumn[,1:2]
WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_long |> 
  left_join(WaterService_vs_GDP_refcolumn, by = "id") |> 
  relocate(refcolumn, .after = "id") |> 
  group_by(refcolumn) |> 
  summarise(GDPpercap = median(GDPpercap, na.rm = TRUE))

# Subsetting to see why na.rm in line 216 doesn't work
WaterService_vs_GDP_regionAVG_median <- WaterService_vs_GDP_regionAVG |> 
  filter(refcolumn == "Central and Southern Asia_2000_national_basic_NA") |> 
  summarise(GDPmedian = median(GDPpercap, na.rm = TRUE))

#  summarise(GDPpercap = median(GDPpercap, na.rm = TRUE))
#            country_population_1000 = sum(country_population_1000, na.rm = TRUE),
#            served_population_1000 = sum(served_population_1000, na.rm = TRUE)) 
#  rename(sdgregion_year_residence_levelsservice_methodservice = refcolumn) |> 
#  rename(population_1000 = served_population_1000) |>
#  separate_wider_delim(cols = sdgregion_year_residence_levelsservice_methodservice,
#                       names = c("sdg_region", "year", "residence", "levels_service", "method_waterservice"),
#                       delim = "_") |> 
#  mutate(year = as.numeric(year)) |> 
#  mutate(id = row_number()) |> 
#  relocate(id, .before = sdg_region)
#WaterService_vs_GDP_regionAVG_refcolumn <- WaterService_vs_GDP_regionAVG[,1:4] |> 
#  unite(region_year_residence, sdg_region, year, residence, sep = "_")
#WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG |> 
#  left_join(WaterService_vs_GDP_regionAVG_refcolumn, by = "id")
#WaterService_vs_GDP_region_yearlysum <- WaterService_vs_GDP_regionAVG |> 
#  filter(levels_service == "surface" | levels_service == "unimproved" | levels_service == "limited" | levels_service == "basic") |> 
#  group_by(sdg_region, year, residence) |> 
#  summarise(served_population_1000 = sum(population_1000)) |> 
#  unite(region_year_residence, sdg_region, year, residence, sep = "_")
#WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG |> 
#  left_join(WaterService_vs_GDP_region_yearlysum, by = "region_year_residence")
#WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG |>
#  mutate(percentage = population_1000/served_population_1000) |> 
#  relocate(region_year_residence, .after = residence) |> 
#  mutate(new_region = sdg_region) |> 
#  relocate(new_region, .before = year)

# Counting world average so that we can compare access level average of the world to ASEAN countries
#WaterService_vs_GDP_refcolumn2 <- WaterService_vs_GDP_long |> 
#  unite(refcolumn, year, residence, levels_service, method_waterservice, sep = "_") |> 
#  relocate(refcolumn, .after = "id") |> 
#  # cek sum dari sini
#  mutate(served_population_1000 = population_1000 * percentage / 100) |> 
#  relocate(served_population_1000, .after = refcolumn)
#WaterService_vs_GDP_refcolumn2 <- WaterService_vs_GDP_refcolumn2[,1:3]
#WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_long |> 
#  left_join(WaterService_vs_GDP_refcolumn2, by = "id") |> 
#  relocate(refcolumn, .after = "id") |> 
#  group_by(refcolumn) |>
#  # ini yang kayaknya salah sum
#  summarise(served_population_1000 = sum(served_population_1000, na.rm = TRUE)) |> 
#  rename(year_residence_levelsservice_methodservice = refcolumn) |> 
#  rename(population_1000 = served_population_1000) |>
#  separate_wider_delim(cols = year_residence_levelsservice_methodservice,
#                       names = c("year", "residence", "levels_service", "method_waterservice"),
#                       delim = "_") |> 
#  mutate(year = as.numeric(year)) |> 
#  mutate(id = row_number()) |> 
#  relocate(id, .before = year)
#WaterService_vs_GDP_worldAVG_refcolumn <- WaterService_vs_GDP_worldAVG[,1:3] |> 
#  unite(year_residence, year, residence, sep = "_") |> 
#  mutate(id = row_number()) |> 
#  relocate(id, .before = year_residence)
#WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_worldAVG |> 
#  left_join(WaterService_vs_GDP_worldAVG_refcolumn, by = "id")
#WaterService_vs_GDP_world_yearlysum <- WaterService_vs_GDP_worldAVG |> 
#  filter(levels_service == "surface" | levels_service == "unimproved" | levels_service == "limited" | levels_service == "basic") |> 
#  group_by(year, residence) |> 
#  summarise(served_population_1000 = sum(population_1000)) |> 
#  unite(year_residence, year, residence, sep = "_")
#WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_worldAVG |> 
#  left_join(WaterService_vs_GDP_world_yearlysum, by = "year_residence")
#WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_worldAVG |>
#  mutate(percentage = population_1000/served_population_1000) |> 
#  relocate(year_residence, .after = residence) |> 
#  mutate(new_region = "World average") |> 
#  relocate(new_region, .before = year)

# Binding region average and world average to WaterService_vs_GDP object
#WaterService_vs_GDP <- bind_rows(WaterService_vs_GDP_long, WaterService_vs_GDP_regionAVG, WaterService_vs_GDP_worldAVG)
#WaterService_vs_GDP_ASEAN <- WaterService_vs_GDP |> 
#  filter(!is.na(new_region)) |> 
#  mutate(id = row_number()) |> 
#  relocate(sdg_region, .after = year_residence) |>
#  rename(region = new_region) |> 
#  rename(levels_waterservice = levels_service) |> 
#  mutate(levels_waterservice = factor(levels_waterservice, levels = factor_waterservice))
#WaterService_vs_GDP_ASEAN <- WaterService_vs_GDP_ASEAN[,1:12]
#glimpse(WaterService_vs_GDP_ASEAN)

# Writing WaterService_vs_GDP_ASEAN.csv from  WaterService_vs_GDP_ASEAN object
#write_csv(WaterService_vs_GDP_ASEAN, here::here("data/processed/WaterService_vs_GDP_ASEAN.csv"))

```

### Analyzing and visualizing the data

(TBD)

```{r}

# 1st plot = comparing service levels of ASEAN countries to other regions
#WaterService_vs_GDP_ASEAN_plot1 <- WaterService_vs_GDP_ASEAN |> 
#  filter(residence == "national",
#         year == 2022) |> 
#  group_by(region) |> 
#  summarise(GDPpercap = median(GDPpercap, na.rm = TRUE),
#           percentage = mean(percentage, na.rm = TRUE))

#ggplot(data = WaterService_vs_GDP_ASEAN_plot1,
#       mapping = aes(x = region, y = percentage)) +
#  geom_col()


```

## Results

(TBD)

## Conclusions

(TBD)

## References

(TBD)
