---
title: "Drinking Water Access and Gross Domestic Product (GDP) per capita in ASEAN Countries: A Comparative Study"
date: today
author:
  name: "Adnan Wijayarso"
  orcid: 0009-0005-0216-5559
  email: "adnanwijayarso@gmail.com"
abstract:
  (to be summarized)
license: "CC BY"
format: 
  html:
    toc: true
    code-fold: true
execute: 
  warning: false
citation: 
  container-title: My Blog
  url: https://www.example.com
editor: source
---

## Introduction

Clean drinking water is essential for our life, therefore universal access to safe drinking water is a fundamental human right. On September 2000, the United Nations declared the Millenium Development Goals (MDGs) which targeted to halve the proportion of the population without sustainable access to safe drinking water by 2015. The agenda was even made to be more ambitious by the declaration of Sustainable Development Goals (SDGs) in 2016 which targets all countries participating to ensure availability of safely managed drinking water by 2030.

Achieving the goal obviously requires tremendous resources, and Gross Domestic Product (GDP) is the most used tool by governments to measure the economic health of a country. This data analysis project is meant to explore how drinking water access differs across ASEAN countries and how it correlates with Gross Domestic Product (GDP) per capita for each country.

## Methods

### Importing and tidying the data

In this project, we're using two data sets:

1.  The WHO/UNICEF Joint Monitoring Programme for [Water Supply, Sanitation, and Hygiene (JMP) Global Database](https://washdata.org/data/household#!/)

2.  The World Bank and OECD National Accounts data files on [GDP per capita (in current US$) for East Asia & Pacific Region](https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?end=2022&locations=4E&start=1960&view=chart)

```{r}
# Loading the packages
library(tidyverse)
library(readxl)
library(janitor)

# Importing datasets
WLD_data_raw <- read_excel(here::here("data/raw/JMP_2023_WLD_.xlsx"))
GDPpercap_raw <- read_excel(here::here("data/raw/API_NY.GDP.PCAP.CD_DS2_en_excel_v2_6298460_.xlsx"))

# Tidying JMP datasets
WLD_data_noref <- WLD_data_raw[3:5361,] |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = "DRINKING WATER") |>
  relocate(...43, .before = "DRINKING WATER") |> 
  rename(sdg_region = ...43) |> 
  rename(country = `DRINKING WATER`) |> 
  rename(year = Year) |> 
  rename(population_1000 = `Population(thousands)`) |> 
  rename(rural_basic = RURAL...6) |> 
  rename(rural_limited = ...7) |> 
  rename(rural_unimproved = ...8) |> 
  rename(rural_surfacewater = ...9) |> 
  rename(urban_basic = URBAN...11) |> 
  rename(urban_limited = ...12) |> 
  rename(urban_unimproved = ...13) |> 
  rename(urban_surfacewater = ...14) |> 
  rename(national_basic = TOTAL...16) |> 
  rename(national_limited = ...17) |> 
  rename(national_unimproved = ...18) |> 
  rename(national_surfacewater = ...19) |> 
  rename(rural_safelymanaged = RURAL...21) |> 
  relocate(rural_safelymanaged, .before = rural_basic) |> 
  rename(rural_piped = ...26) |> 
  rename(rural_nonpiped = ...27) |> 
  rename(urban_safelymanaged = URBAN...28) |> 
  relocate(urban_safelymanaged, .before = urban_basic) |> 
  rename(urban_piped = ...33) |> 
  rename(urban_nonpiped = ...34) |> 
  rename(national_safelymanaged = TOTAL...35) |> 
  relocate(national_safelymanaged, .before = national_basic) |> 
  rename(national_piped = ...40) |> 
  rename(national_nonpiped = ...41) |> 
  relocate(...10, .after = ...46) |> 
  relocate(...15, .after = ...46) |> 
  relocate(...20, .after = ...46) |> 
  relocate(...22, .after = ...46) |> 
  relocate(...23, .after = ...46) |>
  relocate(...24, .after = ...46) |> 
  relocate(...25, .after = ...46) |> 
  relocate(...29, .after = ...46) |> 
  relocate(...30, .after = ...46) |> 
  relocate(...31, .after = ...46) |> 
  relocate(...32, .after = ...46) |> 
  relocate(...36, .after = ...46) |> 
  relocate(...37, .after = ...46) |> 
  relocate(...38, .after = ...46) |> 
  relocate(...39, .after = ...46) |> 
  # Making sure there are no >99 and <1 in rural column
  mutate(rural_safelymanaged = case_when(
    rural_safelymanaged == ">99" ~ "99",
    rural_safelymanaged == "<1" ~ "1",
    TRUE ~ rural_safelymanaged)) |> 
  mutate(rural_basic = case_when(
    rural_basic == ">99" ~ "99",
    rural_basic == "<1" ~ "1",
    TRUE ~ rural_basic)) |>
  mutate(rural_unimproved = case_when(
    rural_unimproved == ">99" ~ "99",
    rural_unimproved == "<1" ~ "1",
    TRUE ~ rural_unimproved)) |>  
  mutate(rural_surfacewater = case_when(
    rural_surfacewater == ">99" ~ "99",
    rural_surfacewater == "<1" ~ "1",
    TRUE ~ rural_surfacewater)) |>  
  mutate(rural_piped = case_when(
    rural_piped == ">99" ~ "99",
    rural_piped == "<1" ~ "1",
    TRUE ~ rural_piped)) |>    
  mutate(rural_nonpiped = case_when(
    rural_nonpiped == ">99" ~ "99",
    rural_nonpiped == "<1" ~ "1",
    TRUE ~ rural_nonpiped)) |>
  # Making sure there are no >99 and <1 in urban column
  mutate(urban_safelymanaged = case_when(
    urban_safelymanaged == ">99" ~ "99",
    urban_safelymanaged == "<1" ~ "1",
    TRUE ~ urban_safelymanaged)) |> 
  mutate(urban_basic = case_when(
    urban_basic == ">99" ~ "99",
    urban_basic == "<1" ~ "1",
    TRUE ~ urban_basic)) |>
  mutate(urban_unimproved = case_when(
    urban_unimproved == ">99" ~ "99",
    urban_unimproved == "<1" ~ "1",
    TRUE ~ urban_unimproved)) |>  
  mutate(urban_surfacewater = case_when(
    urban_surfacewater == ">99" ~ "99",
    urban_surfacewater == "<1" ~ "1",
    TRUE ~ urban_surfacewater)) |>  
  mutate(urban_piped = case_when(
    urban_piped == ">99" ~ "99",
    urban_piped == "<1" ~ "1",
    TRUE ~ urban_piped)) |>    
  mutate(urban_nonpiped = case_when(
    urban_nonpiped == ">99" ~ "99",
    urban_nonpiped == "<1" ~ "1",
    TRUE ~ urban_nonpiped)) |>
  # Making sure there are no >99 and <1 in national column
  mutate(national_safelymanaged = case_when(
    national_safelymanaged == ">99" ~ "99",
    national_safelymanaged == "<1" ~ "1",
    TRUE ~ national_safelymanaged)) |> 
  mutate(national_basic = case_when(
    national_basic == ">99" ~ "99",
    national_basic == "<1" ~ "1",
    TRUE ~ national_basic)) |>
  mutate(national_unimproved = case_when(
    national_unimproved == ">99" ~ "99",
    national_unimproved == "<1" ~ "1",
    TRUE ~ national_unimproved)) |>  
  mutate(national_surfacewater = case_when(
    national_surfacewater == ">99" ~ "99",
    national_surfacewater == "<1" ~ "1",
    TRUE ~ national_surfacewater)) |>  
  mutate(national_piped = case_when(
    national_piped == ">99" ~ "99",
    national_piped == "<1" ~ "1",
    TRUE ~ national_piped)) |>    
  mutate(national_nonpiped = case_when(
    national_nonpiped == ">99" ~ "99",
    national_nonpiped == "<1" ~ "1",
    TRUE ~ national_nonpiped))
WLD_data_noref <- WLD_data_noref[,1:28]
WLD_iso3_year <- WLD_data_noref[,1:5] |> 
  unite(iso3_year, ISO3, year, sep = "_") |> 
  relocate(iso3_year, .after = "id")
WLD_iso3_year <- WLD_iso3_year[,1:2]
WLD_data <- WLD_data_noref |> 
  left_join(WLD_iso3_year, by = "id") |> 
  relocate("iso3_year", .after = year)


# Tidying World Bank GDP per capita dataset
GDPpercap_varnames <- c(GDPpercap_raw[3,])
GDPpercap <- GDPpercap_raw[4:269,]
names(GDPpercap) <- GDPpercap_varnames
GDPpercap <- GDPpercap |> 
  rename(country = `Country Name`) |> 
  rename(iso3 = `Country Code`) |> 
  rename(sdg_region = Region) |> 
  rename(levels_income = IncomeGroup) |> 
  relocate(`Indicator Name`, .before = country) |> 
  relocate(`Indicator Code`, .before = country)
GDPpercap_long_noref <- GDPpercap[,3:69] |> 
  pivot_longer(cols = "1960":"2022",
               names_to = "year",
               values_to = "GDPpercap") |> 
  relocate(year, .after = iso3) |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = country)
GDP_iso3_year <- GDPpercap_long_noref[,1:4] |> 
  unite(iso3_year, iso3, year, sep = "_") |> 
  relocate("iso3_year", .after = "id")
GDPpercap_long <- GDPpercap_long_noref |> 
  left_join(GDP_iso3_year, by = "id") |> 
  relocate(sdg_region, .before = "country.x") |> 
  relocate("iso3_year", .after = "year")
GDPpercap_long <- GDPpercap_long[,6:8] |> 
  mutate(id = row_number()) |> 
  relocate("id", .before = "iso3_year")
  

# Merging JMP and GDP dataset into a new WaterService_vs_GDP object
WaterService_vs_GDP_wide <- WLD_data |> 
  left_join(GDPpercap_long, by = "iso3_year") |> 
  relocate(levels_income, .before = "population_1000") |> 
  relocate(GDPpercap, .before = "population_1000") |> 
  relocate("iso3_year", .after = national_nonpiped)
WaterService_vs_GDP_wide <- WaterService_vs_GDP_wide[,1:30] |> 
  rename(id = id.x)

WaterService_vs_GDP_long <- WaterService_vs_GDP_wide |> 
  # Converting the data frame into long-format data
  pivot_longer(cols = rural_safelymanaged:national_nonpiped,
               names_to = "residence_levelservice",
               values_to = "percentage") |> 
  separate_wider_delim(cols = "residence_levelservice",
                       names = c("residence","level_service"),
                       delim = "_") |> 
  # Tidying level of drinking water service
  mutate(method_waterservice = case_when(
    level_service == "piped" ~ "piped",
    level_service == "nonpiped" ~ "non-piped",
    TRUE ~ NA)) |> 
  mutate(levels_service_new = case_when(
    method_waterservice == "piped" ~ "improved",
    method_waterservice == "non-piped" ~ "improved",
    TRUE ~ level_service)) |> 
  mutate(levels_service = case_when(
    levels_service_new == "safelymanaged" ~ "safely managed",
    levels_service_new == "surfacewater" ~ "surface water",
    TRUE ~ levels_service_new)) |> 
  relocate(levels_service, .before = method_waterservice) |> 
  relocate(percentage, .after = method_waterservice) |> 
  relocate(level_service, .after = percentage) |> 
  mutate(id = row_number()) |> 
  rename(country_population_1000 = population_1000) |> 
  # Removing non-number values from GDPpercap and percentage variable 
  mutate(percentage = as.numeric(percentage)) |> 
  # Counting served population_1000 on national, urban, and rural level
    mutate(served_population_1000 = case_when(
      residence == "national" ~ country_population_1000 * (percentage/100),
      residence == "urban" ~ country_population_1000 * (`% urban`/100) * (percentage/100),
      residence == "rural" ~ country_population_1000 * ((100 - `% urban`)/100) * (percentage/100))) |> 
  relocate(served_population_1000, .after = percentage) |> 
  rename(served_percentage = percentage)
WaterService_vs_GDP_long <- WaterService_vs_GDP_long[,1:14]

# Establishing the level_income and level_service using factor
factor_income <- c("High income","Upper middle income", "Lower middle income", "Low income")
factor_waterservice <- c("safely managed", "improved", "basic", "limited", "unimproved", "surface water")
WaterService_vs_GDP_long <- WaterService_vs_GDP_long |> 
  mutate(levels_income = factor(levels_income, levels = factor_income)) |> 
  mutate(levels_service = factor(levels_service, levels = factor_waterservice)) |> 
  # Creating new ASEAN region
  mutate(new_region = case_when(
    ISO3 == "VNM" ~ "ASEAN",
    ISO3 == "THA" ~ "ASEAN",
    ISO3 == "SGP" ~ "ASEAN",
    ISO3 == "PHL" ~ "ASEAN",
    ISO3 == "MMR" ~ "ASEAN",
    ISO3 == "MYS" ~ "ASEAN",
    ISO3 == "LAO" ~ "ASEAN",
    ISO3 == "KHM" ~ "ASEAN",
    ISO3 == "BRN" ~ "ASEAN",
    ISO3 == "IDN" ~ "ASEAN",
    TRUE ~ NA)) |> 
  relocate(new_region, .after = sdg_region) |> 
  rename(urban_percentage = `% urban`) |> 
  mutate(GDPpercap = as.numeric(GDPpercap))

# Grouping each region so that we can compare the average of each region to ASEAN countries
WaterService_vs_GDP_refcolumn <- WaterService_vs_GDP_long |> 
  unite(refcolumn, sdg_region, year, residence, levels_service, method_waterservice, sep = "_") |> 
  relocate(refcolumn, .after = "id")
WaterService_vs_GDP_refcolumn <- WaterService_vs_GDP_refcolumn[,1:2]
WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_long |> 
  left_join(WaterService_vs_GDP_refcolumn, by = "id") |> 
  relocate(refcolumn, .after = "id") |> 
  mutate(GDPpercap = as.numeric(GDPpercap)) |> 
  group_by(refcolumn) |> 
  summarise(GDPpercap = median(GDPpercap, na.rm = TRUE),
            served_population_1000 = sum(served_population_1000, na.rm = TRUE),
            country_population_1000 = sum(country_population_1000, na.rm = TRUE)) |> 
  rename(sdgregion_year_residence_levelsservice_methodservice = refcolumn) |> 
  separate_wider_delim(cols = sdgregion_year_residence_levelsservice_methodservice,
                       names = c("sdg_region", "year", "residence", "levels_service", "method_waterservice"),
                       delim = "_") |> 
  mutate(year = as.numeric(year)) |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = sdg_region) |> 
  mutate(new_region = sdg_region) |> 
  relocate(new_region, .after = sdg_region)
# Calculating urban percentage and joining them to WaterService_vs_GDP_worldAVG object
WaterService_vs_GDP_region_urbanpercentage <- WaterService_vs_GDP_regionAVG |> 
  filter(residence == "urban",
         levels_service == "surface water" | levels_service == "unimproved" | levels_service == "limited" | levels_service == "basic") |> 
  group_by(sdg_region, year) |> 
  summarise(urban_population_1000 = sum(served_population_1000),
            country_population_1000 = max(country_population_1000)) |> 
  mutate(urban_percentage = urban_population_1000 / country_population_1000 * 100) |> 
  relocate(urban_percentage, .after = year) |> 
  unite(region_year, sdg_region, year, sep = "_")

# Biar WaterService_vs_GDP_regionAVG bisa dijoin sama WaterService_vs_GDP_region_urbanpercentage
WaterService_vs_GDP_regionAVG_refcolumn <- WaterService_vs_GDP_regionAVG[,1:4] |> 
  unite(region_year, sdg_region, year, sep = "_")
WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG |> 
  left_join(WaterService_vs_GDP_regionAVG_refcolumn[,1:2], by = "id")
WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG |> 
  left_join(WaterService_vs_GDP_region_urbanpercentage[,1:2], by = "region_year") |> 
  relocate(GDPpercap, .after = year) |> 
  relocate(country_population_1000, .after = GDPpercap) |> 
  relocate(urban_percentage, .after = country_population_1000) |> 
  mutate(served_percentage = served_population_1000 / country_population_1000 * 100) |> 
  relocate(served_percentage, .before = served_population_1000)
WaterService_vs_GDP_regionAVG <- WaterService_vs_GDP_regionAVG[,1:12]

# Counting world average so that we can compare access level average of the world to ASEAN countries
WaterService_vs_GDP_refcolumn2 <- WaterService_vs_GDP_long |> 
  unite(refcolumn, year, residence, levels_service, method_waterservice, sep = "_") |> 
  relocate(refcolumn, .after = "id") |> 
  relocate(served_population_1000, .after = refcolumn)
WaterService_vs_GDP_refcolumn2 <- WaterService_vs_GDP_refcolumn2[,1:2]
WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_long |> 
  left_join(WaterService_vs_GDP_refcolumn2, by = "id") |> 
  relocate(refcolumn, .after = "id") |>
  mutate(GDPpercap = as.numeric(GDPpercap)) |> 
  group_by(refcolumn) |>
  summarise(served_population_1000 = sum(served_population_1000, na.rm = TRUE),
            country_population_1000 = sum(country_population_1000, na.rm = TRUE),
            GDPpercap = median(GDPpercap, na.rm = TRUE)) |>  
  rename(year_residence_levelsservice_methodservice = "refcolumn") |> 
  rename(population_1000 = served_population_1000) |>
  separate_wider_delim(cols = year_residence_levelsservice_methodservice,
                       names = c("year", "residence", "levels_service", "method_waterservice"),
                       delim = "_") |> 
  mutate(year = as.numeric(year)) |> 
  mutate(id = row_number()) |> 
  relocate(id, .before = year) |> 
  mutate(new_region = "World average") |> 
  relocate(new_region, .before = year)
# Calculating urban percentage and joining them to WaterService_vs_GDP_worldAVG object
WaterService_vs_GDP_world_urbanpercentage <- WaterService_vs_GDP_worldAVG |> 
  filter(residence == "urban",
         levels_service == "surface water" | levels_service == "unimproved" | levels_service == "limited" | levels_service == "basic") |> 
  group_by(year) |> 
  summarise(urban_population_1000 = sum(population_1000),
            country_population_1000 = max(country_population_1000)) |> 
  mutate(urban_percentage = urban_population_1000 / country_population_1000 * 100) |> 
  relocate(urban_percentage, .after = year)
WaterService_vs_GDP_worldAVG <- WaterService_vs_GDP_worldAVG |> 
  left_join(WaterService_vs_GDP_world_urbanpercentage[,1:2], by = "year") |> 
  relocate(GDPpercap, .after = "year") |> 
  relocate(country_population_1000, .after = GDPpercap) |> 
  rename(served_population_1000 = population_1000) |> 
  relocate(urban_percentage, .after = country_population_1000) |> 
  mutate(served_percentage = served_population_1000 / country_population_1000 * 100) |> 
  relocate(served_percentage, .before = served_population_1000)

# Binding region average and world average to WaterService_vs_GDP_region_worldAVG object
WaterService_vs_GDP_region_worldAVG <- bind_rows(WaterService_vs_GDP_regionAVG, WaterService_vs_GDP_worldAVG)
WaterService_vs_GDP_region_worldAVG <- WaterService_vs_GDP_region_worldAVG |> 
  relocate(sdg_region, .after = served_population_1000) |>
  rename(region = new_region) |>
  rename(levels_waterservice = levels_service) |> 
  mutate(levels_waterservice = factor(levels_waterservice, levels = factor_waterservice))
WaterService_vs_GDP_region_worldAVG <- WaterService_vs_GDP_region_worldAVG[,1:11]

# Creating WaterService_vs_GDP_ASEAN object containing the details of each country 
WaterService_vs_GDP_ASEAN <- WaterService_vs_GDP_long |> 
  filter(new_region == "ASEAN") |> 
  mutate(id = row_number()) |> 
  relocate(sdg_region, .after = served_population_1000) |>
  rename(region = new_region) |> 
  rename(levels_waterservice = levels_service) |> 
  mutate(levels_waterservice = factor(levels_waterservice, levels = factor_waterservice))
WaterService_vs_GDP_ASEAN <- WaterService_vs_GDP_ASEAN[,1:14]

# Writing WaterService_vs_GDP_region_worldAVG.csv from WaterService_vs_GDP_region_worldAVG object
write_csv(WaterService_vs_GDP_region_worldAVG, here::here("data/processed/WaterService_vs_GDP_region_worldAVG.csv"))

# Writing WaterService_vs_GDP_ASEAN.csv from  WaterService_vs_GDP_ASEAN object
write_csv(WaterService_vs_GDP_ASEAN, here::here("data/processed/WaterService_vs_GDP_ASEAN.csv"))


```

### Analyzing and visualizing the data

(TBD)

```{r}
#| fig-width: 8
#| label: fig-1
#| fig-cap: ASEAN drinking water service level, compared to other SDG regions and world average

library(ggplot2)

# 1st plot = comparing 2022 drinking water service levels of ASEAN countries to other regions and world average

# Filtering ASEAN's 2022 data on the national level of drinking water service levels
# Preparing ASEAN urban percentage
WaterService_vs_GDP_ASEAN_2022_nationalurban <- WaterService_vs_GDP_ASEAN |> 
  filter(year == 2022,
         residence == "national" | residence == "urban",
         levels_waterservice != "safely managed" & levels_waterservice != "improved") |> 
  group_by(region, residence, levels_waterservice) |> 
  summarise(served_population_1000 = sum(served_population_1000, na.rm = TRUE),
            country_population_1000 = sum(country_population_1000, na.rm = TRUE)) |> 
  group_by(region, residence) |> 
  summarise(served_population_1000 = sum(served_population_1000, na.rm = TRUE),
            country_population_1000 = mean(country_population_1000, na.rm = TRUE)) |> 
  mutate(urban_percentage = served_population_1000 / country_population_1000 * 100) |> 
  relocate(urban_percentage, .after = region)
WaterService_vs_GDP_ASEANAVG_2022 <- WaterService_vs_GDP_ASEAN |> 
  filter(year == 2022,
         residence == "national",
         levels_waterservice != "safely managed" & levels_waterservice != "improved") |> 
  group_by(region, year, residence, levels_waterservice) |> 
  summarise(served_population_1000 = sum(served_population_1000, na.rm = TRUE),
            country_population_1000 = sum(country_population_1000, na.rm = TRUE),
            GDPpercap = median(GDPpercap, na.rm = TRUE)) |> 
  mutate(served_percentage = served_population_1000 / country_population_1000 * 100) |> 
  left_join(WaterService_vs_GDP_ASEAN_2022_nationalurban[2,1:2])

# Filtering region and world average data of drinking water service levels
WaterService_vs_GDP_region_worldAVG_2022 <- WaterService_vs_GDP_region_worldAVG |> 
  filter(year == 2022,
         residence == "national",
         levels_waterservice != "safely managed" & levels_waterservice != "improved")

# Data to be plotted
plot1 <- WaterService_vs_GDP_region_worldAVG_2022 |> 
  bind_rows(WaterService_vs_GDP_ASEANAVG_2022) |>
  mutate(id = row_number())
glimpse(plot1)
ggplot(data = plot1,
       mapping = aes(x = region,
                     y = served_percentage,
                     fill = levels_waterservice)) +
  geom_col() +
  coord_flip() +
  labs(x = "Region", y = "% of served households") +
  geom_text(aes(label = round(served_percentage, 1)),
            position = position_stack(vjust = 0.5),
            size = 3,
            color = "white") +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(title = "Water service level"))


```

## Results

(TBD)

## Conclusions

(TBD)

## References

(TBD)
